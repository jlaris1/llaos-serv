    
extends ../../../layouts/layout.jade
block contenido
    script.
        var estanques = [];

        $(document).ready( function(){
            $('#subMenuAdministracion').removeClass('hidden');
            $('#spanMenuAdministracion').removeClass('fa-angle-left');
            $('#spanMenuAdministracion').addClass('fa-angle-down'); 
            $('#subMenuAdmGranja').removeClass('hidden');
            $('#spanMenuAdmGranja').removeClass('fa-angle-left');
            $('#spanMenuAdmGranja').addClass('fa-angle-down');
            $('#subMenuEstanques').removeClass('hidden');
            $('#spanMenuEstanques').removeClass('fa-angle-left');
            $('#spanMenuEstanques').addClass('fa-angle-down');
            $('#subMenuEstanques').removeClass('hidden');
            $('#spanMenuEstanques').removeClass('fa-angle-left');
            $('#spanMenuEstanques').addClass('fa-angle-down');

            dibujarEstanques();
        });

        function convetirArray(){            
            var arr = $('#estanques').val().split("},");

            for(var i = 0; i < arr.length; i ++){
                var aObj = arr[i].replace(/'/g, '');
                var obj = new Object();   
                
                obj.codigo = aObj.split(",")[0].split(":")[1];;
                obj.nombre = aObj.split(",")[0].split(":")[1];;
                obj.modulo = aObj.split(",")[0].split(":")[1];;
                obj.pointer_x = aObj.split(",")[0].split(":")[1];;
                obj.pointer_y = aObj.split(",")[0].split(":")[1];;
                obj.marker_x = aObj.split(",")[0].split(":")[1];;
                obj.marker_y = aObj.split(",")[0].split(":")[1];;
                obj.location = aObj.split(",")[0].split(":")[1];;

                estanques.push(obj);
            }
        }

        function getColor(d) {
            return d > 1000 ? '#800026' :
                d > 500  ? '#BD0026' :
                d > 200  ? '#E31A1C' :
                d > 100  ? '#FC4E2A' :
                d > 50   ? '#FD8D3C' :
                d > 20   ? '#FEB24C' :
                d > 10   ? '#FED976' :
                            '#FFEDA0';
        }
         
        function dibujarEstanques(){
            var pointerIcon = L.icon({
                iconUrl: '/imgs/pointer.png',
            
                iconSize:     [30, 50], // size of the icon
                //shadowSize:   [50, 64], // size of the shadow
                iconAnchor:   [30, 50], // point of the icon which will correspond to marker's location
                //shadowAnchor: [4, 62],  // the same for the shadow
                //popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
            });

            // Mostrar Mapa
            var mymap = L.map('map').setView([27.30673, -110.41087], 15);

            L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
                maxZoom: 18,
                subdomains:['mt0','mt1','mt2','mt3']
            }).addTo(mymap);


            var location_piscina = [];
            var piscinaData = [];
            var location_piscinas = [];

            $.post("indicators/piscinas", (data) => {
                
                // AGREGAR DIBUJOS DE PISCINAS
                var indicators = L.polygon(data.indicators,
                    {
                        fillColor: "#FC4E2A",
                        weight: 2,
                        opacity: 1,
                        color: 'white',
                        dashArray: '3',
                        fillOpacity: 0.7
                    }
                ).addTo(mymap);
                
                // AGREGAR MARCADORES
                for(let i = 0; i <= data.markers.length - 1; i++) {
                    marker = new L.marker([data.markers[i][0],data.markers[i][1]])
                        .bindPopup(data.markers[i][2])
                        .addTo(mymap);
                    
                }

            }, "json");
        }
    // Termina script

    .row
        .col-lg-9.col-md-9.col-xs-9
            h2
                i.fas.fa-water(style="margin-right: 10px;")
                |   Indicadores de piscinas
        .col-lg-3.col-md-3.col-sm-3.col-xs-3.text-right(style="margin-top: 15px;")
            a.btn.btn-special(href="/estanque/all")
                i.fas.fa-arrow-alt-circle-left
                |   Regresar
        .divider
    .row
        input#piscinas.hidden(value="#{piscinas}")
        input#estanques.hidden(value="#{estanques}")
        .col-lg-12
            #map(style="width: 100%; min-height: 800px;")